<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    	<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>我的钱包</title>
		<link rel="stylesheet" type="text/css" href="aui/css/aui.css"/>
		<link rel="stylesheet" type="text/css" href="css/common.css"/>
		<link rel="stylesheet" type="text/css" href="css/order_pay.css"/>
	</head>
	<body>
		<header class="aui-bar aui-bar-nav headtop" style="">
		    <a class="aui-pull-left" onclick="javascript:history.go(-1);">
		        <span class="aui-iconfont aui-icon-left"></span>
		    </a>
		    <div class="aui-title">押金支付</div>
		</header>
		
		<div class="aui-content main">
		   <div class="aui-row cash">
		   		<div class="aui-list-item-title tit">
		   			交纳押金
		   		</div>
		   		<p>押金随心退，住房无需再消费</p>
		   		<div class="aui-list-item-title money">
		   			200元(可秒退)
		   		</div>
		   </div>
		</div>
		
		
		<div class="aui-content pay-list">
		    <ul class="aui-list aui-list-in">
		        <!--<li class="aui-list-item">
		            <div class="aui-list-item-label-icon">
		                <i class="aui-iconfont">
		                	<img src="img/yue.png"/>
		                </i>
		            </div>
		            <label>
			            <div class="aui-list-item-inner">
			                <div class="aui-list-item-title">
			                	我的余额<span class="yue">（￥4.8元）</span>
			                	<p><span class="activity">最高立减20元</span></p>
			                </div>
			                <div class="aui-list-item-right">
			                    <input type="radio" name="pay" class="aui-radio" value="1" checked>
			                </div>
			            </div>
		            </label>
		        </li>-->
		        <li class="aui-list-item">
		           <div class="aui-list-item-label-icon">
		                <i class="aui-iconfont">
		                	<img src="img/pay-wx.png"/>
		                </i>
		            </div>
		            <label>
			            <div class="aui-list-item-inner">
			                <div class="aui-list-item-title">
			                	微信支付
			               <!--  	<p><span class="activity">最高立减20元</span></p> -->
			                </div>
			                <div class="aui-list-item-right">
			                    <input type="radio" name="pay" class="aui-radio" value="2" checked="checked">
			                </div>
			            </div>
		            </label>
		        </li>
		        <li class="aui-list-item">
		           <div class="aui-list-item-label-icon">
		                <i class="aui-iconfont">
		                	<img src="img/pay-zfb.png"/>
		                </i>
		            </div>
		            <label>
			            <div class="aui-list-item-inner">
			                <div class="aui-list-item-title">
			                	支付宝支付
			                <!-- 	<p><span class="activity">最高立减20元</span></p> -->
			                </div>
			                <div class="aui-list-item-right">
			                    <input type="radio" name="pay" class="aui-radio" value="3">
			                </div>
			            </div>
		            </label>
		        </li>
		       <!--  <li class="aui-list-item">
		           <div class="aui-list-item-label-icon">
		                <i class="aui-iconfont">
		                	<img src="img/pay-yhk.png"/>
		                </i>
		            </div>
		            <label>
			            <div class="aui-list-item-inner">
			                <div class="aui-list-item-title">
			                	银行卡支付
			                <p><span class="activity">最高立减20元</span></p>
			                </div>
			                <div class="aui-list-item-right">
			                    <input type="radio" name="pay" class="aui-radio" value="4">
			                </div>
			            </div>
		            </label>
		        </li> -->
		    </ul>
		</div>
		<div class="aui-content-padded help">
			 <p class=""><a href="">扣款问题</a> | <a href="">信用卡使用问题</a> | <a href="">温馨提示</a></p>
		</div>
		<div class="aui-content-padded pay-btn">
			<p><div class="aui-btn aui-btn-warning aui-btn-block" id="payBtn">立即支付</div></p>
		</div>
		
		<!--遮罩-->
		<div class="aui-mask"></div>
		<!--余额支付-->
		<div class="aui-content aui-content-padded yue-pay" id="yuePay" style="display: none;">
			<div class="aui-list">
				<header class="aui-bar aui-bar-nav">
				    <a class="aui-pull-left aui-btn" onclick="closeShade()">
				        <span class="aui-iconfont aui-icon-close"></span>
				    </a>
				    <div class="aui-title">确认支付</div>
				</header>
				
				<div class="aui-list-item">
					<div class="aui-list-item-label-icon">
		                <i class="aui-iconfont">
		                	<img src="img/yue.png"/>
		                </i>
		            </div>
		            <div class="aui-list-item-inner">
		            	<div class="aui-list-item-title">
		            		我的余额<span class="yue">（￥4.8元）</span>
		            	</div>
		            </div>
				</div>
				<div class="aui-list-item pay-money">
					<div class="aui-list-item-title">
						￥440.00
					</div>
				</div>
				<div class="aui-list-item pay-btn">
					<p><div class="aui-btn aui-btn-warning aui-btn-block" onclick="closeShade()">立即支付</div></p>
				</div>
				
			</div>
		</div>
		
	</body>
	<script src="aui/script/api.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="aui/script/aui-toast.js" ></script>
		<script src="js/base.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/queryString.js" type="text/javascript" charset="utf-8"></script>
	<script src="layer/layer.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		var toast = new auiToast();
		function showDefault(){
			toast.loading({
                title:"加载中",
                duration:2000
            },function(ret){
                console.log(ret);
                setTimeout(function(){
                    toast.hide();
                }, 3000)
            });
		}
			
	
		
		$("#payBtn").on('click',function(){
			
			if($('input:radio[name="pay"]:checked').val()==2){
				//showDefault();
//				$('.aui-mask').addClass('aui-mask-in');
//				$('#yuePay').show();
				payment('wx');
			}else{
				payment('zfb');	
			}
			
		})
		
		function closeShade(){
			$('.aui-mask').removeClass('aui-mask-in');
			$('#yuePay').hide();
		}
		
		$("body").delegate('.aui-mask.aui-mask-in','click',function(e){
			$(this).removeClass("aui-mask-in");
			$('#yuePay').hide();
			e.stopPropagation();   
		})
		

		function payment(payType){
			if(payType=='wx'){//微信支付
			layer.load(2,{offset:['50%','50%']});
	    	base.jsonPost('/app/appOrders/cashPledgeGoPay/json',{userid:base.getUser().id,payType:payType,amount:0.01},function(data){
	    		layer.closeAll();
	    		if(data.status=='success'){
	    			data=data.data;
	    			 var params = {
					    partnerid : data.partnerid,
					    prepayid : data.prepayid,
					    noncestr : data.noncestr,
					    timestamp : data.timestamp,
					    sign : data.sign
					};
					Wechat.sendPaymentRequest(params, function () {
					 	  layer.alert('支付成功');
                                base.refreshUser();	      
					}, function (reason) {
						layer.alert("发起支付请求失败，原因：" + reason);
					});
	    		}else{
	    			layer.alert(data.message);
	    		}
	    	});
	
			}else if(payType=='zfb'){//支付宝支付x
				layer.load(2,{offset:['50%','50%']});
	    		base.jsonPost('/app/appOrders/cashPledgeGoPay/json',{userid:base.getUser().id,payType:payType,amount:0.01},function(data){
	    		layer.closeAll();
	    		if(data.status=='success'){
	    			  window.Alipay.Base.pay(data.data, function(successResults) {
                            var payres = successResults.resultStatus;
                            if (payres === "9000") {
                               	layer.alert('支付成功');
                                base.refreshUser();	      
                            } else if (payres == "6001") {
                                layer.msg("已取消支付", {
                                    time: 2000
                                });
                            } else if (payres == "6002") {
                                layer.msg("网络连接出错", {
                                    time: 2000
                                });
                            } else if (payres == "4000") {
                                layer.msg("订单支付失败", {
                                    time: 2000
                                });
                            } else if (payres == "8000") {
                                layer.msg("正在处理中", {
                                    time: 2000
                                });
                            }
                        }, function(errorResult) {
                            layer.msg("发起支付失败", {
                                time: 2000
                            });
                        });
	    		}else{
	    			layer.alert(data.message);
	    		}
	    	});
			}else if(payType=='yue'){//余额支付
				
			}
		
		}
		
	</script>
</html>
